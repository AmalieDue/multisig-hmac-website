<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Multisig HMAC</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=generator content="Hugo 0.74.3"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link href=/multisig-hmac-website/dist/css/app.4fc0b62e4b82c997bb0041217cd6b979.css rel=stylesheet><link href=/multisig-hmac-website/index.xml rel=alternate type=application/rss+xml title="Multisig HMAC"><link href=/multisig-hmac-website/index.xml rel=feed type=application/rss+xml title="Multisig HMAC"><meta property="og:title" content><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://amaliedue.github.io/multisig-hmac-website/"><meta property="og:updated_time" content="2020-08-04T09:38:32+02:00"><meta itemprop=name content><meta itemprop=description content><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content></head><body class="ma0 avenir bg-near-white"><header><div class="pb3-m pb6-l bg-black"><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/multisig-hmac-website/ class="f3 fw2 hover-white no-underline white-90 dib">Multisig HMAC</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/multisig-hmac-website/#java title="Java page">Java</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/multisig-hmac-website/#javascript title="Javascript page">Javascript</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/multisig-hmac-website/#python title="Python page">Python</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/multisig-hmac-website/#security-analysis title="Security Analysis page">Security Analysis</a></li></ul><a href=https://twitter.com/DueAmalie target=_blank class="link-transition twitter link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href=https://github.com/AmalieDue/ target=_blank class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel=noopener aria-label="follow on Github——Opens in a new window"><svg height="32" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></nav><div class="tc-l pv3 ph3 ph4-ns"><h1 class="f2 f-subheadline-l fw2 light-silver mb0 lh-title">Multisig HMAC</h1></div></div></header><main class=pb7 role=main><article class="pa pa4-ns nested-copy-line-height nested-img ml5 mr7"><h2 id=about-the-project>About the project</h2><p>Multisig HMAC is a novel, symmetric signature scheme allowing a threshold of signers to form a quorum. This scheme takes each separate signature and a bitfield indicating the keys used, which are combinable in any order, allowing for simple threshold schemes, or more advanced authentication flows.</p><p>Key management can happen in either of two modes, either by storing every of the component keys, or by storing a single master seed and using that to derive keys ad hoc.</p><p>Fully open-source implementations in <a href=#javascript>Javascript</a>, <a href=#python>Python</a>, and <a href=#java>Java</a> and available on Github, npm, PyPI, and MavenCentral:</p><ul><li><a href=https://github.com/emilbayes/multisig-hmac>https://github.com/emilbayes/multisig-hmac</a> <a href=https://www.npmjs.com/package/multisig-hmac>(npm)</a></li><li><a href=https://github.com/AmalieDue/py-multisig-hmac>https://github.com/AmalieDue/multisig-hmac</a> <a href=https://pypi.org/project/multisig-hmac/>(PyPI)</a></li><li><a href=https://github.com/AmalieDue/java-multisig-hmac>https://github.com/AmalieDue/multisig-hmac</a> <a href=https://search.maven.org/artifact/dk.hyperdivision/multisig_hmac/2.0.0/jar>(MavenCentral)</a></li></ul><hr><h2 id=javascript>Javascript</h2><p>Example from the Javascript implementation, using stored keys:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>MultisigHMAC</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;multisig-hmac&#39;</span>)

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>multisigHmac</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>MultisigHMAC</span>()

<span style=color:#75715e>// generate keys, which need to be stored securely
</span><span style=color:#75715e>// and need to be shared securely with each party
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>k1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>multisigHmac</span>.<span style=color:#a6e22e>keygen</span>(<span style=color:#ae81ff>1</span>)
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>k2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>multisigHmac</span>.<span style=color:#a6e22e>keygen</span>(<span style=color:#ae81ff>2</span>)
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>k3</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>multisigHmac</span>.<span style=color:#a6e22e>keygen</span>(<span style=color:#ae81ff>3</span>)

<span style=color:#75715e>// Sign by each client with 2-of-3
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Buffer</span>.<span style=color:#a6e22e>from</span>(<span style=color:#e6db74>&#39;Hello world&#39;</span>)

<span style=color:#75715e>// Notice no mention of nonce here. The data can follow whatever format you
</span><span style=color:#75715e>// desire, but should include a nonce
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>s1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>multisigHmac</span>.<span style=color:#a6e22e>sign</span>(<span style=color:#a6e22e>k1</span>, <span style=color:#a6e22e>data</span>)
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>s3</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>multisigHmac</span>.<span style=color:#a6e22e>sign</span>(<span style=color:#a6e22e>k3</span>, <span style=color:#a6e22e>data</span>)

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>signature</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>multisigHmac</span>.<span style=color:#a6e22e>combine</span>([<span style=color:#a6e22e>s1</span>, <span style=color:#a6e22e>s3</span>])

<span style=color:#75715e>// Verify on the server
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>threshold</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>keys</span> <span style=color:#f92672>=</span> [<span style=color:#a6e22e>k1</span>, <span style=color:#a6e22e>k2</span>, <span style=color:#a6e22e>k3</span>]
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>verified</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>multisigHmac</span>.<span style=color:#a6e22e>verify</span>(<span style=color:#a6e22e>keys</span>, <span style=color:#a6e22e>signature</span>, <span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>threshold</span>)
<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>verified</span>)
</code></pre></div><p>Example from the Javascript implementation, using a derived master key:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>MultisigHMAC</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;multisig-hmac&#39;</span>)

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>multisigHmac</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>MultisigHMAC</span>()

<span style=color:#75715e>// Generate a master seed, which needs to be stored securely
</span><span style=color:#75715e>// This seed must NOT be shared with any other party
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>seed</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>multisigHmac</span>.<span style=color:#a6e22e>seedgen</span>()

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>k1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>multisigHmac</span>.<span style=color:#a6e22e>deriveKey</span>(<span style=color:#a6e22e>seed</span>, <span style=color:#ae81ff>1</span>)
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>k2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>multisigHmac</span>.<span style=color:#a6e22e>deriveKey</span>(<span style=color:#a6e22e>seed</span>, <span style=color:#ae81ff>2</span>)
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>k3</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>multisigHmac</span>.<span style=color:#a6e22e>deriveKey</span>(<span style=color:#a6e22e>seed</span>, <span style=color:#ae81ff>3</span>)

<span style=color:#75715e>// Sign by each client with 2-of-3
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Buffer</span>.<span style=color:#a6e22e>from</span>(<span style=color:#e6db74>&#39;Hello world&#39;</span>)

<span style=color:#75715e>// Notice no mention of nonce here. The data can follow whatever format you
</span><span style=color:#75715e>// desire, but should include a nonce
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>s1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>multisigHmac</span>.<span style=color:#a6e22e>sign</span>(<span style=color:#a6e22e>k1</span>, <span style=color:#a6e22e>data</span>)
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>s3</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>multisigHmac</span>.<span style=color:#a6e22e>sign</span>(<span style=color:#a6e22e>k3</span>, <span style=color:#a6e22e>data</span>)

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>signature</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>multisigHmac</span>.<span style=color:#a6e22e>combine</span>([<span style=color:#a6e22e>s1</span>, <span style=color:#a6e22e>s3</span>])

<span style=color:#75715e>// Verify on the server, but now keys are dynamically derived
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>threshold</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>verified</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>multisigHmac</span>.<span style=color:#a6e22e>verifyDerived</span>(<span style=color:#a6e22e>seed</span>, <span style=color:#a6e22e>signature</span>, <span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>threshold</span>)
<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>verified</span>)
</code></pre></div><hr><h2 id=python>Python</h2><p>Example from the Python implementation, using stored keys:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> multisig_hmac
<span style=color:#f92672>from</span> multisig_hmac.multisig_hmac <span style=color:#f92672>import</span> MultisigHMAC
<span style=color:#f92672>import</span> base64

m <span style=color:#f92672>=</span> MultisigHMAC()

<span style=color:#75715e># generate keys which need to be stored securely and need to be shared securely with each party</span>
k0 <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span>keygen(<span style=color:#ae81ff>0</span>)
k1 <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span>keygen(<span style=color:#ae81ff>1</span>)
k2 <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span>keygen(<span style=color:#ae81ff>2</span>)

<span style=color:#75715e># sign by each client</span>
data <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;hello world&#39;</span>

s0 <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span>sign(k0, data)
s2 <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span>sign(k2, data)

<span style=color:#75715e># combine the used signatures</span>
out <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span>combine([s0, s2])

sent <span style=color:#f92672>=</span> (out[<span style=color:#ae81ff>0</span>], base64<span style=color:#f92672>.</span>urlsafe_b64encode(out[<span style=color:#ae81ff>1</span>]))

<span style=color:#75715e># --- network ---</span>

received <span style=color:#f92672>=</span> (sent[<span style=color:#ae81ff>0</span>], base64<span style=color:#f92672>.</span>urlsafe_b64decode(sent[<span style=color:#ae81ff>1</span>]))

<span style=color:#75715e># verify on the server</span>
threshold <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>
keys <span style=color:#f92672>=</span> [k0, k1, k2]
signature <span style=color:#f92672>=</span> received

<span style=color:#66d9ef>print</span>(m<span style=color:#f92672>.</span>verify(keys, signature, data, threshold))
</code></pre></div><p>Example from the Python implementation, using a derived master key:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> multisig_hmac
<span style=color:#f92672>from</span> multisig_hmac.multisig_hmac <span style=color:#f92672>import</span> MultisigHMAC
<span style=color:#f92672>import</span> base64

m <span style=color:#f92672>=</span> MultisigHMAC()

<span style=color:#75715e># generate a master seed which needs to be stored securely</span>
<span style=color:#75715e># this seed must NOT be shared with any other party</span>
seed <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span>seedgen()

k0 <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span>deriveKey(seed, <span style=color:#ae81ff>0</span>)
k1 <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span>deriveKey(seed, <span style=color:#ae81ff>1</span>)
k2 <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span>deriveKey(seed, <span style=color:#ae81ff>2</span>)

<span style=color:#75715e># sign by each client</span>
data <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;hello world&#39;</span>

s0 <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span>sign(k0, data)
s2 <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span>sign(k2, data)

<span style=color:#75715e># combine the used signatures</span>
out <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span>combine([s0, s2])

sent <span style=color:#f92672>=</span> (out[<span style=color:#ae81ff>0</span>], base64<span style=color:#f92672>.</span>urlsafe_b64encode(out[<span style=color:#ae81ff>1</span>]))

<span style=color:#75715e># --- network ---</span>

received <span style=color:#f92672>=</span> (sent[<span style=color:#ae81ff>0</span>], base64<span style=color:#f92672>.</span>urlsafe_b64decode(sent[<span style=color:#ae81ff>1</span>]))

<span style=color:#75715e># verify on the server, but now keys are dynamically derived</span>
threshold <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>
signature <span style=color:#f92672>=</span> received

<span style=color:#66d9ef>print</span>(m<span style=color:#f92672>.</span>verifyDerived(seed, signature, data, threshold))
</code></pre></div><hr><h2 id=java>Java</h2><p>Example from the Java implementation, using stored keys:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#f92672>package</span> dk.hyperdivision.multisig_hmac<span style=color:#f92672>;</span>

<span style=color:#f92672>import</span> java.util.*<span style=color:#f92672>;</span>

<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>StoredKeys</span> <span style=color:#f92672>{</span>

    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> InvalidKeyException<span style=color:#f92672>,</span> NoSuchAlgorithmException <span style=color:#f92672>{</span>
    
        MultisigHMAC m <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MultisigHMAC<span style=color:#f92672>(</span>MultisigHMAC<span style=color:#f92672>.</span><span style=color:#a6e22e>Algorithm</span><span style=color:#f92672>.</span><span style=color:#a6e22e>HmacSHA256</span><span style=color:#f92672>);</span>

        Key k0 <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span><span style=color:#a6e22e>generate</span><span style=color:#f92672>(</span>0<span style=color:#f92672>);</span>
        Key k1 <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span><span style=color:#a6e22e>generate</span><span style=color:#f92672>(</span>1<span style=color:#f92672>);</span>
        Key k2 <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span><span style=color:#a6e22e>generate</span><span style=color:#f92672>(</span>2<span style=color:#f92672>);</span>

        <span style=color:#66d9ef>byte</span><span style=color:#f92672>[]</span> message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;hello world&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getBytes</span><span style=color:#f92672>();</span>

        Signature s0 <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span><span style=color:#a6e22e>sign</span><span style=color:#f92672>(</span>k0<span style=color:#f92672>,</span> message<span style=color:#f92672>);</span>
        Signature s2 <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span><span style=color:#a6e22e>sign</span><span style=color:#f92672>(</span>k2<span style=color:#f92672>,</span> message<span style=color:#f92672>);</span>

        List<span style=color:#f92672>&lt;</span>Signature<span style=color:#f92672>&gt;</span> signatures <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;();</span>
        signatures<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span>s0<span style=color:#f92672>);</span>
        signatures<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span>s2<span style=color:#f92672>);</span>
    
        Signature combined <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span><span style=color:#a6e22e>combine</span><span style=color:#f92672>(</span>signatures<span style=color:#f92672>);</span>

        List<span style=color:#f92672>&lt;</span>Key<span style=color:#f92672>&gt;</span> keys <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;();</span>
        keys<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span>k0<span style=color:#f92672>);</span>
        keys<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span>k1<span style=color:#f92672>);</span>
        keys<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span>k2<span style=color:#f92672>);</span>
        <span style=color:#66d9ef>int</span> threshold <span style=color:#f92672>=</span> 2<span style=color:#f92672>;</span>

        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>m<span style=color:#f92672>.</span><span style=color:#a6e22e>verify</span><span style=color:#f92672>(</span>keys<span style=color:#f92672>,</span> combined<span style=color:#f92672>,</span> message<span style=color:#f92672>,</span> threshold<span style=color:#f92672>));</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Example from the Java implementation, using a derived master key:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#f92672>package</span> dk.hyperdivision.multisig_hmac<span style=color:#f92672>;</span>

<span style=color:#f92672>import</span> java.util.*<span style=color:#f92672>;</span>

<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DerivedKeys</span> <span style=color:#f92672>{</span>

    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> NoSuchAlgorithmException<span style=color:#f92672>,</span> InvalidKeyException <span style=color:#f92672>{</span>
    
        DerivedMultisigHMAC m <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> DerivedMultisigHMAC<span style=color:#f92672>(</span>DerivedMultisigHMAC<span style=color:#f92672>.</span><span style=color:#a6e22e>Algorithm</span><span style=color:#f92672>.</span><span style=color:#a6e22e>HmacSHA256</span><span style=color:#f92672>);</span>
        
        <span style=color:#66d9ef>byte</span><span style=color:#f92672>[]</span> masterKey <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span><span style=color:#a6e22e>generateMasterKey</span><span style=color:#f92672>();</span>

        Key k0 <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span><span style=color:#a6e22e>generate</span><span style=color:#f92672>(</span>0<span style=color:#f92672>,</span> masterKey<span style=color:#f92672>);</span>
        Key k1 <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span><span style=color:#a6e22e>generate</span><span style=color:#f92672>(</span>1<span style=color:#f92672>,</span> masterKey<span style=color:#f92672>);</span>
        Key k2 <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span><span style=color:#a6e22e>generate</span><span style=color:#f92672>(</span>2<span style=color:#f92672>,</span> masterKey<span style=color:#f92672>);</span>

        <span style=color:#66d9ef>byte</span><span style=color:#f92672>[]</span> message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;hello world&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getBytes</span><span style=color:#f92672>();</span>

        Signature s0 <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span><span style=color:#a6e22e>sign</span><span style=color:#f92672>(</span>k0<span style=color:#f92672>,</span> message<span style=color:#f92672>);</span>
        Signature s2 <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span><span style=color:#a6e22e>sign</span><span style=color:#f92672>(</span>k2<span style=color:#f92672>,</span> message<span style=color:#f92672>);</span>

        List<span style=color:#f92672>&lt;</span>Sign<span style=color:#f92672>&gt;</span> signatures <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;();</span>
        signatures<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span>s0<span style=color:#f92672>);</span>
        signatures<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span>s2<span style=color:#f92672>);</span>
        <span style=color:#66d9ef>int</span> threshold <span style=color:#f92672>=</span> 2<span style=color:#f92672>;</span>

        Signature combined <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span><span style=color:#a6e22e>combine</span><span style=color:#f92672>(</span>signatures<span style=color:#f92672>);</span>

        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>print</span><span style=color:#f92672>(</span>m<span style=color:#f92672>.</span><span style=color:#a6e22e>verify</span><span style=color:#f92672>(</span>masterKey<span style=color:#f92672>,</span> combined<span style=color:#f92672>,</span> message<span style=color:#f92672>,</span> threshold<span style=color:#f92672>));</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><hr><h2 id=security-analysis>Security Analysis</h2><p>The cryptographic strength of the HMAC depends on the size of the secret key that is used. In this project, the maximum key sizes are used. Since the implementations support SHA256, SHA512, and SHA384 for HMAC, then key sizes of 64, 128, and 128 bytes respectively are used (i.e. 512, 1024, and 1024 bits respectively). The HMAC values have sizes 32, 64, and 48 bytes respectively (256, 512, and 384 bits respectively). In cryptography, a Pseudo Random Function family, PRF, is a collection of functions which emulate a random oracle in the following way: There exists no efficient algorithm that can distinguish between a function randomly chosen from the PRF family and a function whose outputs are completely random. In 2006, it was proved that HMAC is a PRF under the assumption that the compression function is a PRF. A way to prove that the XOR of two PRFs, or more specifically two HMACs in this case, is also PRF is by thinking about the contrapositive of the statement: If the XOR of two HMACs is not PRF, then HMAC is not PRF. The idea is to suppose that an adversary or distinguisher <em>D</em> breaks the secrecy of the XOR&rsquo;ed PRFs and then use <em>D</em> to construct a distinguisher <em>D&rsquo;</em> which can break the security of at least one of the single PRF&rsquo;s. The conclusion of the proof is that</p><ul><li>If two XOR&rsquo;ed HMACs is not PRF, then HMAC is not PRF.</li><li>It was proved in 2006 that HMAC is PRF.</li><li>Hence: Two XOR&rsquo;ed HMACs is PRF.</li></ul><p>See more about the security of HMACs on the <a href=https://en.wikipedia.org/wiki/HMAC#Security>Wikipedia page</a>.</p><p>With an HMAC output size of 256 bits, there are N = 2^256 different HMAC values. When one HMAC value has been picked, there are N-1 HMAC values remaining. The probability of randomly picking two unique HMAC values is (N-1)/N, and likewise the probability of randomly picking the same HMAC value twice is therefore</p><pre><code class=language-math data-lang=math>1 - (N-1)/N = N/N - (N-1)/N = (N-N+1)/N = 1/N. 
</code></pre><p>As the XOR&rsquo;ing of two HMAC values is also PRF according to some proofs, the security level is still satisfied, i.e. the birthday bound still holds: It is possible to find a collision of HMAC values in 2^(n/2).</p><p>In conclusion, the probability that XOR&rsquo;ing some number of signatures will not be successfull is negligible.</p></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://amaliedue.github.io/multisig-hmac-website/>&copy; Multisig HMAC 2020</a><div><a href=https://twitter.com/DueAmalie target=_blank class="link-transition twitter link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href=https://github.com/AmalieDue/ target=_blank class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel=noopener aria-label="follow on Github——Opens in a new window"><svg height="32" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></footer><script src=/multisig-hmac-website/dist/js/app.3fc0f988d21662902933.js></script></body></html>